@model Car

@{
    ViewData["Title"] = Model.Manufacturer + " " + Model.Model + " " + Model.YearOfProduction;
}

<h1 class="text-center">Car Details</h1>

@if (User.IsInRole("Moderator"))
{
    <div class=" text-center col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <a class="btn btn-warning btn-md edit-car-all-btn" asp-controller="Car" asp-action="Edit" asp-route-id="@Model.Id">Edit</a>
        <a class="btn btn-danger btn-md delete-car-all-btn" asp-controller="Car" asp-action="Delete" asp-route-id="@Model.Id">Delete</a>
    </div>
}

<div class="col-md-8 col-md-offset-2 details-page-heading">
    <div class="pull-left">
        <h3>@Model.Manufacturer @Model.Model</h3>
    </div>
    <div class="p-r">
        <h3>&euro; @Model.Price</h3>
        <p>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
        </p>
    </div>
</div>

<div class="col-md-8 details-images text-center">
    @if (Model.Images.Count <= 0)
    {
        <img src="~/images/not-found.png" class="col-md-4 details-img clearfix" alt="No Image">
    }
    else
    {
        @foreach (var image in Model.Images)
        {
            <img src="~/images/@image.ImageUrl" class="col-md-4 details-img clearfix" alt="@Model.Manufacturer @Model.Model">
        }
    }
</div>

<div class="col-md-4 car-details-sidebar single-block">
    <h2 class="title">Specifications</h2>
    <ul>
        <li>
            <span>Make</span>@Model.Manufacturer
        </li>
        <li>
            <span>Model</span>@Model.Model
        </li>
        <li>
            <span>Body Type</span>@Model.BodyType
        </li>
        <li>
            <span>Year</span>@Model.YearOfProduction
        </li>
        <li>
            <span>Condition</span>@Model.Condition
        </li>
        <li>
            <span>Travelled Distance</span>@Model.TravelledDistance km
        </li>
        <li>
            <span>Color</span>@Model.Color
        </li>
        <li>
            <span>Transmission</span>@Model.TypeOfTransmission
        </li>
        <li>
            <span>Engine</span>@Model.EngineType
        </li>
        <li>
            <span>Euro Standart</span>@Model.EuroStandart
        </li>
        <li>
            <span>Horsepower</span>@Model.HorsePower
        </li>
    </ul>
</div>

<div class="details-page-description col-md-12">
    <h3>Description</h3>
    <p>@Model.SaleDescription</p>
</div>

<div class="text-center details-buy-car-btn col-md-12">
    <a class="btn btn-primary" asp-controller="Car" asp-action="Buy" asp-route-id="@Model.Id">Buy this car</a>
</div>

<div class="text-center col-md-12">
    @if (!Model.Comments.Any())
    {
        <p>There are no comments for @Model.Manufacturer @Model.Model!</p>
    }
    else
    {
        @foreach (var comment in Model.Comments)
        {

            @if (comment.ParentCommentId == null)
            {
                <div class="well comment">
                    <h1>@comment.Author.UserName</h1>
                    <h2>@comment.Content</h2>

                    @if (User.IsInRole("Moderator"))
                    {
                        <button data-commentId="@comment.Id" class="btn delete-comment-btn">Delete comment</button>
                    }

                    @foreach (var subCom in Model.Comments)
                    {
                        @if (subCom.ParentCommentId == comment.Id)
                        {
                            <div class="col-md-offset-1 col-lg-offset-1 table-bordered comment">
                                <h3>@subCom.Author.UserName</h3>
                                <h4>@subCom.Content</h4>
                                @if (User.IsInRole("Moderator"))
                                {
                                    <button data-commentId="@subCom.Id" class="btn delete-comment-btn">Delete comment</button>
                                }
                            </div>
                        }
                    }
                    @if (User.Identity.IsAuthenticated)
                    {
                        <form asp-controller="Car" asp-action="AddComment" asp-route-id="@Model.Id" asp-route-parentCommentId="@comment.Id">
                            <input id="content" type="text" name="content" />
                            <input type="submit" value="Reply" />
                        </form>
                    }
                </div>
            }

        }
    }

    @if (User.Identity.IsAuthenticated)
    {
        <form asp-controller="Car" asp-action="AddComment" asp-route-id="@Model.Id">
            <input id="content" type="text" name="content" />
            <input type="submit" value="Comment" />
        </form>
    }
</div>

@TempData["test"]

<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/js/add-content-comment.js"></script>
<script src="~/js/delete-comment.js"></script>